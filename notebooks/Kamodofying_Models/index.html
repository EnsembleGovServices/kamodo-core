<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Kamodofying Models - Kamodo Analysis Suite</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../css/ansi-colours.css" rel="stylesheet" />
  <link href="../../css/jupyter-cells.css" rel="stylesheet" />
  <link href="../../css/pandas-dataframe.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Kamodofying Models";
    var mkdocs_page_input_path = "notebooks/Kamodofying_Models.ipynb";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Kamodo Analysis Suite</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Kamodo/">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Visualization/">Visualization</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Syntax/">Syntax</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Kamodofying Models</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#kamodofication-requirements">Kamodofication requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#model-reader-tutorial">Model Reader Tutorial</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#minimal-example-one-variable">Minimal Example: one variable</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#including-defaults">Including defaults</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#final-implementation">Final Implementation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#combined-models">Combined models</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../FieldIntegration/">Field Integration</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../rpc/">RPC</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../API/">API</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING/">Contributing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../additional_resources/">Additional Resources</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Kamodo Analysis Suite</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Kamodofying Models</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="kamodofication-tutorial">Kamodofication Tutorial<a class="headerlink" href="#kamodofication-tutorial" title="Permanent link">&para;</a></h1>
<p>This tutorial focuses on building a Kamodofied model from scratch. To see the full implementation, skip down to the <a href="#Final-Implementation">Final-Implementation</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="kamodofication-requirements">Kamodofication requirements<a class="headerlink" href="#kamodofication-requirements" title="Permanent link">&para;</a></h2>
<p>To Kamodofy models and data representing physical quantities, we need to define a set of functions representing the interpolation of each physical variable having the following properties:</p>
<ul>
<li>A function name and arguments that follows kamodo's <a href="../Syntax/">Syntax</a> conventions </li>
<li>Default arrays for input arguments</li>
<li>A meta attribute containing:<ul>
<li>'units' - physical units of the values returned by the function</li>
<li>'citation' - How the model or data source should be cited</li>
<li>'equation' - LaTeX representation of this model/data source (if available)</li>
<li>'hidden_args' - A list of function arguments that should not be rendered</li>
</ul>
</li>
<li>A data attribute - The array holding the variable (if available)</li>
<li>Any docstrings that provide further context</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="model-reader-tutorial">Model Reader Tutorial<a class="headerlink" href="#model-reader-tutorial" title="Permanent link">&para;</a></h2>
<p>Model Readers load data from disk (or server) and provide methods for interpolation. We require that for each variable of interest, the model reader should provide at least one interpolation method that satisfies all of the above requirements. Each model reader will:</p>
<ol>
<li>Open/close files</li>
<li>Manage state variables</li>
<li>Initialize interpolators</li>
<li>Kamodofy interpolators</li>
<li>Register functions</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="minimal-example-one-variable">Minimal Example: one variable<a class="headerlink" href="#minimal-example-one-variable" title="Permanent link">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">kamodo</span> <span class="kn">import</span> <span class="n">Kamodo</span><span class="p">,</span> <span class="n">kamodofy</span><span class="p">,</span> <span class="n">gridify</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">RegularGridInterpolator</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>kj/filesystem-disk-unix.c++:1690: warning: PWD environment variable doesn&#39;t match current directory; pwd = /Users/asherp/git/ensemblegovservices/kamodo-core
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Kamodo</span><span class="p">):</span> 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># perform any necessary I/O</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;opening </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>

        <span class="c1"># store any data needed for interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span> 

        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">density_data</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xx</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">yy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">zz</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interpolator</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> <span class="n">density_data</span><span class="p">,</span> 
                                                    <span class="n">bounds_error</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                   <span class="n">fill_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_value</span><span class="p">)</span>



        <span class="c1"># Prepare model for function registration for the input argument</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

        <span class="c1"># Wrap the interpolator with a nicer function signature</span>
        <span class="nd">@kamodofy</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;kg*m**-3&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">interpolator</span><span class="p">(</span><span class="n">xvec</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolator</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolator</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="s1">&#39;myfile.dat&#39;</span><span class="p">)</span>
<span class="n">model</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>opening myfile.dat
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\rho{\left(\vec{x} \right)}[\frac{kg}{m^{3}}] = \lambda{\left(\vec{x} \right)}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>we can call the registered function with multiple values, getting <code>nan</code> if out of bounds:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">rho</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>array([83.244,    nan])</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, the registered function has no default parameters, so an error will be raised if we do not provide an argument.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">rho</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>interpolator() missing 1 required positional argument: &#39;xvec&#39;
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At this point, the end-user of the model cannot generate quick-look graphics:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>interpolator() missing 1 required positional argument: &#39;xvec&#39;[]
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to generate any plots, the user must already know where they can place resolution. For example, they could inspect some of the attributes of the model and guess the size of the domain, then choose points from that space.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">zz</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
<span class="n">randints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rho</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">xvec</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">randints</span><span class="p">]</span> <span class="p">))</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># pio.write_image(fig, &#39;images/kamodofied1.svg&#39;)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img alt="kamodofied1" src="../images/kamodofied1.svg" /></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hopefully, the user doesn't choose points where the solution may be invalid. Next, we'll modify the original function to provide a griddable variable with default parameters.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="including-defaults">Including defaults<a class="headerlink" href="#including-defaults" title="Permanent link">&para;</a></h2>
<p>The above example produced a kamodofied model with one variable, but we are unable to produce quick-look graphics, which required the user to inspect the model to guess where interpolation may be valid. Here we show how to include defaults so the user doesn't have to guess.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Kamodo</span><span class="p">):</span> 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># perform any necessary I/O</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;opening </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>

        <span class="c1"># store any data needed for interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span> 

        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">density_data</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xx</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">yy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">zz</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interpolator</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> <span class="n">density_data</span><span class="p">,</span> 
                                                    <span class="n">bounds_error</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                   <span class="n">fill_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_value</span><span class="p">)</span>



        <span class="c1"># Prepare model for function registration for the input argument</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

        <span class="c1"># Wrap the interpolator with a nicer function signature</span>
        <span class="nd">@kamodofy</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;kg/m**3&#39;</span><span class="p">)</span>
        <span class="nd">@gridify</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="c1"># &lt;--- The only change to the model</span>
        <span class="k">def</span> <span class="nf">interpolator</span><span class="p">(</span><span class="n">xvec</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolator</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolator</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="s1">&#39;myfile.dat&#39;</span><span class="p">)</span>
<span class="n">model</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>opening myfile.dat
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\rho{\left(x,y,z \right)}[\frac{kg}{m^{3}}] = \lambda{\left(x,y,z \right)}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By adding the <code>@gridify</code> line, we have modified the original function to be one that generates gridded data. Moreover, the variable now has default parameters.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">rho</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>(22, 11, 33)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now specify one or more arguments to get a plane mapping of the solution.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>(22, 11)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But how do we know to choose the plane <code>z=8</code> for a valid solution? We can use kamodo's function inspection to get the default ranges for each parameter.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">kamodo</span> <span class="kn">import</span> <span class="n">get_defaults</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">get_defaults</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">rho</span><span class="p">)[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>8.0</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="final-implementation">Final Implementation<a class="headerlink" href="#final-implementation" title="Permanent link">&para;</a></h2>
<p>In the final implementation of our model reader, we include multiple variables with different function signatures. Here, the gridded solutions have suffixes <code>_ijk</code> to emphasize their structure. This allows more flexibility for the end user.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Kamodo</span><span class="p">):</span> 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># perform any necessary I/O</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;opening </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>

        <span class="c1"># store any data needed for interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>        
        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">density_data</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xx</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">yy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">zz</span>
        <span class="n">pressure_data</span> <span class="o">=</span> <span class="n">xx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">zz</span><span class="o">**</span><span class="mi">2</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rho</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">density_data</span><span class="p">),</span>
                              <span class="n">P</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;nPa&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pressure_data</span><span class="p">))</span>

        <span class="c1"># Prepare model for function registration</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

        <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varname</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_variable</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
        <span class="n">interpolator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grid_interpolator</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>

        <span class="c1"># store the interpolator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varname</span><span class="p">][</span><span class="s1">&#39;interpolator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolator</span>

        <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">xvec</span><span class="p">):</span>  
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varname</span><span class="p">][</span><span class="s1">&#39;interpolator&#39;</span><span class="p">](</span><span class="n">xvec</span><span class="p">)</span>

        <span class="c1"># update docstring for this variable</span>
        <span class="n">interpolate</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;A function that returns </span><span class="si">{}</span><span class="s2"> in [</span><span class="si">{}</span><span class="s2">].&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span><span class="n">units</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">kamodofy</span><span class="p">(</span><span class="n">interpolate</span><span class="p">,</span> 
                           <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">,</span> 
                           <span class="n">citation</span> <span class="o">=</span> <span class="s2">&quot;Pembroke et al 2019&quot;</span><span class="p">,</span>
                          <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">varname</span> <span class="o">+</span> <span class="s1">&#39;_ijk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kamodofy</span><span class="p">(</span><span class="n">gridify</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">varname</span><span class="p">],</span> 
                                                  <span class="n">x_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> 
                                                  <span class="n">y_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> 
                                                  <span class="n">z_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                            <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">,</span>
                            <span class="n">citation</span> <span class="o">=</span> <span class="s2">&quot;Pembroke et al 2019&quot;</span><span class="p">,</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varname</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">get_grid_interpolator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;create a regulard grid interpolator for this variable&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varname</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

        <span class="n">interpolator</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> 
                                                <span class="n">bounds_error</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                               <span class="n">fill_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">interpolator</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="s1">&#39;myfile.dat&#39;</span><span class="p">)</span>
<span class="n">model</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>opening myfile.dat
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\rho{\left(\vec{x} \right)}[\frac{kg}{m^{3}}] = \lambda{\left(\vec{x} \right)}\end{equation} \begin{equation}\rho_{ijk}{\left(x_{i},y_{j},z_{k} \right)}[\frac{kg}{m^{3}}] = \lambda{\left(x_{i},y_{j},z_{k} \right)}\end{equation} \begin{equation}P{\left(\vec{x} \right)}[nPa] = \lambda{\left(\vec{x} \right)}\end{equation} \begin{equation}\operatorname{P_{ijk}}{\left(x_{i},y_{j},z_{k} \right)}[nPa] = \lambda{\left(x_{i},y_{j},z_{k} \right)}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">rho</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>array(83.244)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">P</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>array(93.02)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">detail</span><span class="p">()</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<table>
<thead><tr>
<th style="text-align:left"></th>
<th style="text-align:left">symbol</th>
<th style="text-align:left">units</th>
<th style="text-align:left">lhs</th>
<th style="text-align:left">rhs</th>
<th style="text-align:left">arg_units</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">rho</td>
<td style="text-align:left">rho(xvec)</td>
<td style="text-align:left">kg/m**3</td>
<td style="text-align:left">rho</td>
<td style="text-align:left">lambda(xvec)</td>
<td style="text-align:left">None</td>
</tr>
<tr>
<td style="text-align:left">rho_ijk</td>
<td style="text-align:left">rho_ijk(x_i, y_j, z_k)</td>
<td style="text-align:left">kg/m**3</td>
<td style="text-align:left">rho_ijk</td>
<td style="text-align:left">lambda(x_i, y_j, z_k)</td>
<td style="text-align:left">None</td>
</tr>
<tr>
<td style="text-align:left">P</td>
<td style="text-align:left">P(xvec)</td>
<td style="text-align:left">nPa</td>
<td style="text-align:left">P</td>
<td style="text-align:left">lambda(xvec)</td>
<td style="text-align:left">None</td>
</tr>
<tr>
<td style="text-align:left">P_ijk</td>
<td style="text-align:left">P_ijk(x_i, y_j, z_k)</td>
<td style="text-align:left">nPa</td>
<td style="text-align:left">P_ijk</td>
<td style="text-align:left">lambda(x_i, y_j, z_k)</td>
<td style="text-align:left">None</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here the <code>@kamodofy</code> decorator handles the provisioning of kamodo-specific metadata. For example, the declared function <code>rho</code> now has a <code>meta</code> attribute:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">meta</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>{&#39;units&#39;: &#39;kg/m**3&#39;,
 &#39;arg_units&#39;: None,
 &#39;citation&#39;: &#39;Pembroke et al 2019&#39;,
 &#39;equation&#39;: None,
 &#39;hidden_args&#39;: []}</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>@kamodofy</code> also adds the data attribute, by calling the function with its default parameters:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">rho_ijk</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>(11, 22, 33)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="combined-models">Combined models<a class="headerlink" href="#combined-models" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We could also register the model's interpolating method as part of some other Kamodo object, such as another kamodofied model reader or data source:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">kamodo</span> <span class="kn">import</span> <span class="n">Kamodo</span>
<span class="n">kamodo</span> <span class="o">=</span> <span class="n">Kamodo</span><span class="p">(</span><span class="n">rho</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span>
<span class="n">kamodo</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\rho{\left(\vec{x} \right)}[\frac{kg}{m^{3}}] = \lambda{\left(\vec{x} \right)}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now compose our density function with expressions defined by other models:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="p">[</span><span class="s1">&#39;vol[m^3]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;4/3 * pi * (xvec)**(3/2)&#39;</span>
<span class="n">kamodo</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\rho{\left(\vec{x} \right)}[\frac{kg}{m^{3}}] = \lambda{\left(\vec{x} \right)}\end{equation} \begin{equation}\operatorname{vol}{\left(\vec{x} \right)}[m^{3}] = \frac{4 \pi \vec{x}^{\frac{3}{2}}}{3}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rho*vol&#39;</span>
<span class="n">kamodo</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\rho{\left(\vec{x} \right)}[\frac{kg}{m^{3}}] = \lambda{\left(\vec{x} \right)}\end{equation} \begin{equation}\operatorname{vol}{\left(\vec{x} \right)}[m^{3}] = \frac{4 \pi \vec{x}^{\frac{3}{2}}}{3}\end{equation} \begin{equation}\operatorname{mass}{\left(\vec{x} \right)}[kg] = \rho{\left(\vec{x} \right)} \operatorname{vol}{\left(\vec{x} \right)}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="o">.</span><span class="n">detail</span><span class="p">()</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<table>
<thead><tr>
<th style="text-align:left"></th>
<th style="text-align:left">symbol</th>
<th style="text-align:left">units</th>
<th style="text-align:left">lhs</th>
<th style="text-align:left">rhs</th>
<th style="text-align:left">arg_units</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">rho</td>
<td style="text-align:left">rho(xvec)</td>
<td style="text-align:left">kg/m**3</td>
<td style="text-align:left">rho</td>
<td style="text-align:left">lambda(xvec)</td>
<td style="text-align:left">None</td>
</tr>
<tr>
<td style="text-align:left">vol</td>
<td style="text-align:left">vol(xvec)</td>
<td style="text-align:left">m**3</td>
<td style="text-align:left">vol</td>
<td style="text-align:left">4<em>pi</em>xvec**(3/2)/3</td>
<td style="text-align:left">{}</td>
</tr>
<tr>
<td style="text-align:left">mass</td>
<td style="text-align:left">mass(xvec)</td>
<td style="text-align:left">kg</td>
<td style="text-align:left">mass</td>
<td style="text-align:left">rho(xvec)*vol(xvec)</td>
<td style="text-align:left">{}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following lines will save the image to your working directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Saving images requires <code>plotly-orca-1.2.1</code>, available through conda: <code>conda install -c plotly plotly-orca</code></p>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">rho_ijk</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>(22, 11, 33)</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rho_ijk</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">z_k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">init_notebook_mode</span><span class="p">,</span> <span class="n">plot</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea ">
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.4.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rho_ijk</span> <span class="o">=</span>  <span class="nb">dict</span><span class="p">(</span><span class="n">z_k</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">mean</span><span class="p">()]))</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">pio</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s1">&#39;kamodofied_model_1.svg&#39;</span><span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We use markdown to embed the image into the notebook.
<img alt="Kamodofied Density" src="../kamodofied_model_1.svg?5" /></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Alternative ways to graph:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1">## uncomment to open interactive plot in the notebook</span>
<span class="c1"># from plotly.offline import init_notebook_mode, iplot</span>
<span class="c1"># init_notebook_mode(connected = True)</span>
<span class="c1"># iplot(kamodo.plot(rho = dict(x = model.x.mean()))) </span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># # uncomment to open interactive plot in separate tab</span>
<span class="c1"># from plotly.offline import plot</span>
<span class="c1"># plot(kamodo.plot(rho = dict(z = 8))) </span>
</code></pre></div>



</div>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../FieldIntegration/" class="btn btn-neutral float-right" title="Field Integration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Syntax/" class="btn btn-neutral" title="Syntax"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../Syntax/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../FieldIntegration/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
