<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Field Integration - Kamodo Analysis Suite</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../css/ansi-colours.css" rel="stylesheet" />
  <link href="../../css/jupyter-cells.css" rel="stylesheet" />
  <link href="../../css/pandas-dataframe.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Field Integration";
    var mkdocs_page_input_path = "notebooks/FieldIntegration.ipynb";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Kamodo Analysis Suite</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Kamodo/">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Visualization/">Visualization</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Syntax/">Syntax</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Kamodofying_Models/">Kamodofying Models</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Field Integration</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#dipole-field-model">Dipole field model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#normalization">Normalization</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#solving-the-initial-value-problem">Solving the initial value problem</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#evaluating-the-solutions">Evaluating the Solutions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#complex-parameterization">Complex parameterization</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#plotting-fieldlines">Plotting Fieldlines</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#integration-totals">Integration totals</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../API/">API</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING/">Contributing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../additional_resources/">Additional Resources</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Kamodo Analysis Suite</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Field Integration</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="field-integration-techniques">Field Integration Techniques<a class="headerlink" href="#field-integration-techniques" title="Permanent link">&para;</a></h1>
<p>Many analysis techniques for vector fields require solving an initial value problem for an arbitrary set of seed points and evaluating such solutions at a chosen resolution. Kamodo makes it easy to generate fieldline solutions by providing a function decorator that wraps scipy's powerful <code>solve_ivp</code> function. Each family of solutions is represented by a single function of a complex parameter. We illustrate the flexibility of this approach in the example below.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># initialize</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">init_notebook_mode</span>
<span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">kamodo</span> <span class="kn">import</span> <span class="n">Kamodo</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">pointlike</span><span class="p">,</span> <span class="n">kamodofy</span><span class="p">,</span> <span class="n">solve</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea ">
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.4.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="dipole-field-model">Dipole field model<a class="headerlink" href="#dipole-field-model" title="Permanent link">&para;</a></h2>
<p>We use the following dipole field model that can accept (m,) and (1,m), and (n,m) arrays.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">Bdip</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Need math to work in a variety of arg shapes&quot;&quot;&quot;</span>
    <span class="n">muvec</span> <span class="o">=</span> <span class="n">Bdip</span><span class="o">.</span><span class="n">muvec</span>    
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">rhat</span> <span class="o">=</span> <span class="n">rvec</span><span class="o">/</span><span class="n">r</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">rhat</span> <span class="o">=</span> <span class="p">(</span><span class="n">rvec</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rhat</span><span class="p">,</span> <span class="n">muvec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rhat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">muvec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">rhat</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">-</span> <span class="n">muvec</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span> <span class="o">-</span> <span class="n">muvec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">3</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># set dipole moment</span>
<span class="n">Bdip</span><span class="o">.</span><span class="n">muvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> 

<span class="c1"># pointlike enforces dimensionality</span>
<span class="n">Bdip</span> <span class="o">=</span> <span class="n">pointlike</span><span class="p">(</span><span class="n">Bdip</span><span class="p">,</span> <span class="s1">&#39;(n,m)-&gt;(n,m)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span> <span class="o">=</span> <span class="n">Kamodo</span><span class="p">()</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="p">[</span><span class="s1">&#39;Bvec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Bdip</span> <span class="c1"># register the dipole field</span>
<span class="n">kamodo</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\vec{B}{\left(\vec{r} \right)} = \lambda{\left(\vec{r} \right)}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="normalization">Normalization<a class="headerlink" href="#normalization" title="Permanent link">&para;</a></h2>
<p>Instead of solving the initial value problem on the original field, we will be solving on the normalized field. This will mean that the integral path is the same as the arclength, allowing us to control the visual fidelity of the resulting field.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create a normalization function to be applied to our field</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="nd">@kamodofy</span><span class="p">(</span><span class="n">equation</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hat</span><span class="si">{n}</span><span class="s2">(</span><span class="se">\\</span><span class="s2">vec</span><span class="si">{y}</span><span class="s2">) = </span><span class="se">\\</span><span class="s2">vec</span><span class="si">{y}</span><span class="s2">/</span><span class="se">\\</span><span class="s2">sqrt{</span><span class="se">\\</span><span class="s2">vec</span><span class="si">{y}</span><span class="s2"> </span><span class="se">\\</span><span class="s2">cdot </span><span class="se">\\</span><span class="s2">vec</span><span class="si">{y}</span><span class="s2">}&quot;</span><span class="p">)</span>
<span class="nd">@pointlike</span><span class="p">(</span><span class="n">signature</span> <span class="o">=</span> <span class="s1">&#39;(m,n)-&gt;(m,n)&#39;</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">normalized</span><span class="p">(</span><span class="n">yvec</span><span class="p">):</span>   
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">yvec</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">yvec</span><span class="o">/</span><span class="n">r</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">yvec</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


<span class="n">kamodo</span><span class="p">[</span><span class="s1">&#39;nhat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create a normalized field</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="p">[</span><span class="s1">&#39;bhat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;nhat(Bvec)&quot;</span>
<span class="n">kamodo</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\vec{B}{\left(\vec{r} \right)} = \lambda{\left(\vec{r} \right)}\end{equation} \begin{equation}\hat{n}{\left(\vec{y} \right)} = \hat{n}(\vec{y}) = \vec{y}/\sqrt{\vec{y} \cdot \vec{y}}\end{equation} \begin{equation}\hat{b}{\left(\vec{r} \right)} = \hat{n}{\left(\vec{B}{\left(\vec{r} \right)} \right)}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="solving-the-initial-value-problem">Solving the initial value problem<a class="headerlink" href="#solving-the-initial-value-problem" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Generate a set of seed points for integration</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">z0</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">seeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">z0</span><span class="p">)]))</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create a stopping boundary for field line integrator</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="nd">@event</span>
<span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">rvec</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rvec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Solve the initial value problem for the normalized field</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="p">[</span><span class="s1">&#39;svec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">kamodo</span><span class="o">.</span><span class="n">bhat</span><span class="p">,</span> <span class="c1"># the field to be solved</span>
                       <span class="n">seeds</span><span class="p">,</span> <span class="c1"># the initial positions</span>
                       <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="c1"># the name of the integration parameter</span>
                       <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="c1"># the span to integrate over</span>
                       <span class="n">npoints</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="c1"># the number of points to evaluate the solution</span>
                       <span class="n">events</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">,</span> <span class="c1"># stop at the boundary</span>
                      <span class="p">)</span>
<span class="n">kamodo</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_latex output_subarea output_execute_result">
\begin{equation}\vec{B}{\left(\vec{r} \right)} = \lambda{\left(\vec{r} \right)}\end{equation} \begin{equation}\hat{n}{\left(\vec{y} \right)} = \hat{n}(\vec{y}) = \vec{y}/\sqrt{\vec{y} \cdot \vec{y}}\end{equation} \begin{equation}\hat{b}{\left(\vec{r} \right)} = \hat{n}{\left(\vec{B}{\left(\vec{r} \right)} \right)}\end{equation} \begin{equation}\vec{s}{\left(s \right)} = \lambda{\left(s \right)}\end{equation}
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The solver returns a family of solutions, represented as a single function of a complex array, <span class="arithmatex">\(\vec{s}(s)\)</span> where
<span class="arithmatex">\(s\)</span> is a complex array. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="evaluating-the-solutions">Evaluating the Solutions<a class="headerlink" href="#evaluating-the-solutions" title="Permanent link">&para;</a></h2>
<p>On evaluation, <span class="arithmatex">\(\vec{s}(s)\)</span> returns a pandas dataframe.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="o">.</span><span class="n">svec</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
    <tr>
      <th>seed</th>
      <th>integral</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th rowspan="5" valign="top">0.0</th>
      <th>-6.610169</th>
      <td>-0.347547</td>
      <td>-0.347547</td>
      <td>-0.924155</td>
    </tr>
    <tr>
      <th>-6.101695</th>
      <td>-0.615886</td>
      <td>-0.615886</td>
      <td>-1.261575</td>
    </tr>
    <tr>
      <th>-5.593220</th>
      <td>-0.922735</td>
      <td>-0.922735</td>
      <td>-1.525472</td>
    </tr>
    <tr>
      <th>-5.084746</th>
      <td>-1.256963</td>
      <td>-1.256963</td>
      <td>-1.713145</td>
    </tr>
    <tr>
      <th>-4.576271</th>
      <td>-1.608411</td>
      <td>-1.608411</td>
      <td>-1.822192</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When using the default argument above, the solution evaluates at a resolution of npoints/span, stopping at the boundary.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="complex-parameterization">Complex parameterization<a class="headerlink" href="#complex-parameterization" title="Permanent link">&para;</a></h2>
<p>Kamodo represents the family of solutions to the initial value problem as a single function of a complex array.</p>
<p>The floor of the real part of the input parameter corresponds to the original seed array:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="o">.</span><span class="n">svec</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>array([[-3.14159265, -3.14159265,  1.        ],
       [-1.88495559, -3.14159265,  1.        ],
       [-0.62831853, -3.14159265,  1.        ]])</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>compare with original seeds:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">seeds</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>array([[-3.14159265, -3.14159265,  1.        ],
       [-1.88495559, -3.14159265,  1.        ],
       [-0.62831853, -3.14159265,  1.        ]])</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The imaginary part denotes the integral along the corresponding solution. Here, we can choose evaluation points that were not in the original solution. Parameters outside the original span will be extrapolated.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="o">.</span><span class="n">svec</span><span class="p">([</span><span class="o">-</span><span class="mi">6</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="n">j</span><span class="p">,</span> <span class="mi">6</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="n">j</span><span class="p">,</span> <span class="mi">4</span> <span class="o">-</span><span class="mf">5.777</span><span class="n">j</span><span class="p">])</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
    <tr>
      <th>seed</th>
      <th>integral</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th rowspan="5" valign="top">0.0</th>
      <th>-6.000</th>
      <td>-0.674502</td>
      <td>-0.674502</td>
      <td>-1.320504</td>
    </tr>
    <tr>
      <th>-5.000</th>
      <td>-1.314574</td>
      <td>-1.314574</td>
      <td>-1.737228</td>
    </tr>
    <tr>
      <th>0.000</th>
      <td>-3.141593</td>
      <td>-3.141593</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>5.000</th>
      <td>-0.120606</td>
      <td>-0.120606</td>
      <td>0.491892</td>
    </tr>
    <tr>
      <th>6.000</th>
      <td>0.125472</td>
      <td>0.125472</td>
      <td>-0.393292</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">4.0</th>
      <th>4.000</th>
      <td>0.094223</td>
      <td>-0.157038</td>
      <td>0.481740</td>
    </tr>
    <tr>
      <th>-5.777</th>
      <td>0.234804</td>
      <td>-0.391340</td>
      <td>-0.827054</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="plotting-fieldlines">Plotting Fieldlines<a class="headerlink" href="#plotting-fieldlines" title="Permanent link">&para;</a></h2>
<p>We can quickly generate plots for all fieldlines at the default resolution by calling plot with the name of the fieldlines solution.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">kamodo</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;svec&#39;</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">pio</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s1">&#39;./images/fieldlines.svg&#39;</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img alt="images/fieldlines.svg" src="../images/fieldlines.svg" /></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To show the direction of the field at each point, we can evaluate <span class="arithmatex">\(\hat{B}(\vec{s}(s))\)</span></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">fig</span> <span class="o">=</span> <span class="n">kamodo</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;svec&#39;</span><span class="p">,</span> 
                  <span class="n">bhat</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rvec</span> <span class="o">=</span> <span class="n">kamodo</span><span class="o">.</span><span class="n">svec</span><span class="p">()))</span>
<span class="n">pio</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="s1">&#39;./images/fieldlines_vectors.svg&#39;</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img alt="fieldlines" src="../images/fieldlines_vectors.svg" /></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="integration-totals">Integration totals<a class="headerlink" href="#integration-totals" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To compute the total integral for each fieldline individually, we need a function to subtract the integration results at the endpoints.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="n">fieldline</span><span class="p">):</span>
    <span class="n">endpoints</span> <span class="o">=</span> <span class="n">fieldline</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">integral</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">totals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">seed</span><span class="p">,</span> <span class="n">fieldline</span> <span class="ow">in</span> <span class="n">kamodo</span><span class="o">.</span><span class="n">svec</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;seed&#39;</span><span class="p">):</span>
    <span class="n">totals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">integral</span><span class="p">(</span><span class="n">fieldline</span><span class="p">))</span>

<span class="n">totals</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[10.677966101694915,
 8.64406779661017,
 7.627118644067796,
 7.627118644067796,
 8.64406779661017]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Alternatively, we can use pandas' aggregation methods to apply our function on each fieldline.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">kamodo</span><span class="o">.</span><span class="n">svec</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;seed&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">integral</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
    <tr>
      <th>seed</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th>0.0</th>
      <td>10.677966</td>
      <td>10.677966</td>
      <td>10.677966</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>8.644068</td>
      <td>8.644068</td>
      <td>8.644068</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>7.627119</td>
      <td>7.627119</td>
      <td>7.627119</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>7.627119</td>
      <td>7.627119</td>
      <td>7.627119</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>8.644068</td>
      <td>8.644068</td>
      <td>8.644068</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>10.677966</td>
      <td>10.677966</td>
      <td>10.677966</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>8.644068</td>
      <td>8.644068</td>
      <td>8.644068</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>6.610169</td>
      <td>6.610169</td>
      <td>6.610169</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>5.084746</td>
      <td>5.084746</td>
      <td>5.084746</td>
    </tr>
    <tr>
      <th>9.0</th>
      <td>5.084746</td>
      <td>5.084746</td>
      <td>5.084746</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>6.610169</td>
      <td>6.610169</td>
      <td>6.610169</td>
    </tr>
    <tr>
      <th>11.0</th>
      <td>8.644068</td>
      <td>8.644068</td>
      <td>8.644068</td>
    </tr>
    <tr>
      <th>12.0</th>
      <td>7.627119</td>
      <td>7.627119</td>
      <td>7.627119</td>
    </tr>
    <tr>
      <th>13.0</th>
      <td>5.084746</td>
      <td>5.084746</td>
      <td>5.084746</td>
    </tr>
    <tr>
      <th>14.0</th>
      <td>5.593220</td>
      <td>5.593220</td>
      <td>5.593220</td>
    </tr>
    <tr>
      <th>15.0</th>
      <td>5.593220</td>
      <td>5.593220</td>
      <td>5.593220</td>
    </tr>
    <tr>
      <th>16.0</th>
      <td>5.084746</td>
      <td>5.084746</td>
      <td>5.084746</td>
    </tr>
    <tr>
      <th>17.0</th>
      <td>7.627119</td>
      <td>7.627119</td>
      <td>7.627119</td>
    </tr>
    <tr>
      <th>18.0</th>
      <td>7.627119</td>
      <td>7.627119</td>
      <td>7.627119</td>
    </tr>
    <tr>
      <th>19.0</th>
      <td>5.084746</td>
      <td>5.084746</td>
      <td>5.084746</td>
    </tr>
    <tr>
      <th>20.0</th>
      <td>5.593220</td>
      <td>5.593220</td>
      <td>5.593220</td>
    </tr>
    <tr>
      <th>21.0</th>
      <td>5.593220</td>
      <td>5.593220</td>
      <td>5.593220</td>
    </tr>
    <tr>
      <th>22.0</th>
      <td>5.084746</td>
      <td>5.084746</td>
      <td>5.084746</td>
    </tr>
    <tr>
      <th>23.0</th>
      <td>7.627119</td>
      <td>7.627119</td>
      <td>7.627119</td>
    </tr>
    <tr>
      <th>24.0</th>
      <td>8.644068</td>
      <td>8.644068</td>
      <td>8.644068</td>
    </tr>
    <tr>
      <th>25.0</th>
      <td>6.610169</td>
      <td>6.610169</td>
      <td>6.610169</td>
    </tr>
    <tr>
      <th>26.0</th>
      <td>5.084746</td>
      <td>5.084746</td>
      <td>5.084746</td>
    </tr>
    <tr>
      <th>27.0</th>
      <td>5.084746</td>
      <td>5.084746</td>
      <td>5.084746</td>
    </tr>
    <tr>
      <th>28.0</th>
      <td>6.610169</td>
      <td>6.610169</td>
      <td>6.610169</td>
    </tr>
    <tr>
      <th>29.0</th>
      <td>8.644068</td>
      <td>8.644068</td>
      <td>8.644068</td>
    </tr>
    <tr>
      <th>30.0</th>
      <td>10.677966</td>
      <td>10.677966</td>
      <td>10.677966</td>
    </tr>
    <tr>
      <th>31.0</th>
      <td>8.644068</td>
      <td>8.644068</td>
      <td>8.644068</td>
    </tr>
    <tr>
      <th>32.0</th>
      <td>7.627119</td>
      <td>7.627119</td>
      <td>7.627119</td>
    </tr>
    <tr>
      <th>33.0</th>
      <td>7.627119</td>
      <td>7.627119</td>
      <td>7.627119</td>
    </tr>
    <tr>
      <th>34.0</th>
      <td>8.644068</td>
      <td>8.644068</td>
      <td>8.644068</td>
    </tr>
    <tr>
      <th>35.0</th>
      <td>10.677966</td>
      <td>10.677966</td>
      <td>10.677966</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../API/" class="btn btn-neutral float-right" title="API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Kamodofying_Models/" class="btn btn-neutral" title="Kamodofying Models"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../Kamodofying_Models/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../API/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
